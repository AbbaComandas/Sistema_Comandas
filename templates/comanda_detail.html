{% extends 'base.html' %}
{% load static %}
{% block title %}
    {% if comanda.numero_habitacion %}
        Comanda Hab {{ comanda.numero_habitacion }}
    {% elif comanda.cliente_externo %}
        Comanda {{ comanda.cliente_externo.nombre }}
    {% else %}
        Comanda
    {% endif %}
{% endblock %}

{% block content %}
<link rel="stylesheet" href="{% static 'garzon/css/garzon.css' %}">

<style>
/* Agregar separación entre botones del modal */
.modal-actions {
    display: flex !important;
    gap: 15px !important; 
    margin-top: 20px !important;
    justify-content: center !important;
}

.modal-actions button {
    flex: 1 !important; 
    min-width: 120px !important; 
    padding: 12px 20px !important;
    font-size: 1rem !important;
    font-weight: 600 !important;
    border: none !important;
    border-radius: 8px !important;
    cursor: pointer !important;
    transition: all 0.3s ease !important;
}

/* Botón Confirmar */
#confirm-send.btn-accion {
    background-color: #0b8a3e !important;
    color: white !important;
}

#confirm-send.btn-accion:hover {
    background-color: #0a7a36 !important;
    transform: translateY(-2px) !important;
}

/* Botón Cancelar */
#cancel-send.btn-logout {
    background-color: #f71212ff !important;
    color: white !important;
}

#cancel-send.btn-logout:hover {
    background-color: #f60000ff !important;
    transform: translateY(-2px) !important;
}
@media (max-width: 480px) {
    .modal-actions {
        flex-direction: column !important;
        gap: 10px !important;
    }
    
    .modal-actions button {
        width: 100% !important;
    }
}
</style>

<div class="comanda-container">
    <div class="comanda-header">
        <a href="{% url 'garzon:garzon_home' %}" class="back-arrow">←</a>
        
        {% if comanda.numero_habitacion %}
            <h2>Habitación: {{ comanda.numero_habitacion }}</h2>
        {% elif comanda.cliente_externo %}
            <h2>Cliente: {{ comanda.cliente_externo.nombre }}</h2>
        {% else %}
            <h2>Comanda sin cliente</h2>
        {% endif %}
        
        <div class="estado-comanda {% if comanda.estado == 'P' %}pendiente{% else %}enviada{% endif %}">
            {{ comanda.get_estado_display }}
        </div>
    </div>

    <div class="logo-container">
        <img src="{% static 'img/abba-hotels-logo.png' %}" alt="Logo" class="logo">
    </div>

    <!-- Pestañas -->
    <div class="tabs">
        {% for cat in menu.keys %}
            <button class="tab-btn" data-cat="{{ cat }}">{{ cat }}</button>
        {% endfor %}
    </div>

    <!-- Notas para cocina -->
    <div class="notas-cocina-container">
        <label for="notas-cocina" class="notas-label">Notas para Cocina:</label>
        <textarea id="notas-cocina" placeholder="Ej: Sin cebolla, bien cocido, alérgico al maní..."></textarea>
    </div>

    <div id="items-list" class="items-list">
        <!-- JS llenará los items de la categoría activa -->
        <script>
            window.MENU = {{ menu|safe }};
            window.COMANDA_ID = {{ comanda.id }};
            window.CSRF_TOKEN = '{{ csrf_token }}';
        </script>
        <script src="{% static 'garzon/js/comanda_detail.js' %}"></script>
    </div>
</div>

<!-- Barra inferior fija -->
<div class="bottom-bar">
    <div id="total-display">Total: $0</div>
    <div class="bottom-actions">
        <button id="enviar-btn" class="btn-logout">Enviar a Cocina</button>
    </div>
</div>

<!-- Modal resumen -->
<div id="modal" class="modal" style="display:none;">
    <div class="modal-content">
        <h3>Resumen de Comanda</h3>
        <div id="resumen-items"></div>
        <div class="modal-actions">
            <button id="confirm-send" class="btn-accion">Confirmar Envío</button>
            <button id="cancel-send" class="btn-logout">Cancelar</button>
        </div>
    </div>
</div>
{% endblock %}
